import{h as U,u as I,i as $,k as z,r as B,j as e}from"./index-BzeirQbh.js";import{P as L}from"./PageLayout-BXdVDYeO.js";import{B as n}from"./Button-DAaJg7TO.js";import{u as q,a as b}from"./index.esm-ROoT7fyu.js";import{F as G,C as f,T as H,a as P}from"./CheckboxInput-bHa850mr.js";import{T as c}from"./TextInput-zMPiYgPU.js";import{S as O}from"./SelectBox-CUC6YG9y.js";import{F as v}from"./PlusIcon-RDI3_RYo.js";const _=()=>{const{id:m}=U(),p=I(),{data:r,isLoading:N}=$(m),[k,{isLoading:C}]=z(),{register:a,handleSubmit:y,control:u,reset:x,formState:{errors:i},setError:w,watch:h}=q(),{fields:E,append:M,remove:F}=b({control:u,name:"pricePairs"}),{fields:T,append:D,remove:S}=b({control:u,name:"features"});B.useEffect(()=>{r&&x({code:r.code,projectsPerMonth:r.projectsPerMonth??void 0,contactClicksPerProject:r.contactClicksPerProject??void 0,unlimitedProjects:r.projectsPerMonth===null,unlimitedClicks:r.contactClicksPerProject===null,notes:r.notes,shortDescription:r.shortDescription,footerText:r.footerText,badge:r.badge,pricePairs:Object.entries(r.prices).map(([s,t])=>({currency:s,amount:Number(t)})),features:(r.features||[]).map(s=>({value:s}))})},[r,x]);const A=async s=>{var t;try{const l={};s.pricePairs.forEach(({currency:o,amount:g})=>{o&&g>=0&&(l[o.toUpperCase()]=Number(g))});const j=(s.features||[]).map(o=>({value:o.value})),d={id:m,code:s.code,prices:l,projectsPerMonth:s.unlimitedProjects?null:Number(s.projectsPerMonth),contactClicksPerProject:s.unlimitedClicks?null:Number(s.contactClicksPerProject),notes:s.notes,shortDescription:s.shortDescription,footerText:s.footerText,badge:s.badge,features:j};console.log(d.prices),await k(d).unwrap(),p("/admin/packages",{state:"updated"})}catch(l){(t=l==null?void 0:l.data)!=null&&t.details&&l.data.details.forEach(d=>{const o=d.field.replace(/^body\./,"");w(o,{type:"server",message:d.message})})}},R=[{label:"Manage Packages",path:"/packages"},{label:"Edit Package",path:`/packages/${m}/edit`}];return N?e.jsx("div",{children:"Loading..."}):e.jsx(L,{title:"Edit Package",breadcrumbs:R,children:e.jsx("form",{onSubmit:y(A),children:e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 mb-6 shadow-md border border-gray-100 dark:border-gray-700",children:[e.jsx(G,{title:"Package Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx(O,{label:"Code",required:!0,...a("code"),options:[{label:"FREE",value:"FREE"},{label:"BASIC",value:"BASIC"},{label:"STANDARD",value:"STANDARD"},{label:"PREMIUM",value:"PREMIUM"}]}),i.code&&e.jsx("span",{className:"text-sm text-red-500",children:i.code.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Projects Per Month"}),e.jsx(f,{label:"Unlimited Projects",...a("unlimitedProjects")})]}),!h("unlimitedProjects")&&e.jsx(c,{placeholder:"Enter Projects Per Month",...a("projectsPerMonth")}),i.projectsPerMonth&&e.jsx("span",{className:"text-sm text-red-500",children:i.projectsPerMonth.message})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Contact Clicks Per Project"}),e.jsx(f,{label:"Unlimited Clicks",...a("unlimitedClicks")})]}),!h("unlimitedClicks")&&e.jsx(c,{placeholder:"Enter Contact Clicks Per Project",...a("contactClicksPerProject")}),i.contactClicksPerProject&&e.jsx("span",{className:"text-sm text-red-500",children:i.contactClicksPerProject.message})]}),e.jsxs("div",{children:[e.jsx(c,{label:"Short Description",placeholder:"Enter short description",required:!0,...a("shortDescription")}),i.shortDescription&&e.jsx("span",{className:"text-sm text-red-500",children:i.shortDescription.message})]}),e.jsxs("div",{children:[e.jsx(c,{label:"Footer Text",placeholder:"Enter footer text",required:!0,...a("footerText")}),i.footerText&&e.jsx("span",{className:"text-sm text-red-500",children:i.footerText.message})]}),e.jsxs("div",{children:[e.jsx(c,{label:"Badge",placeholder:"Enter badge text",...a("badge")}),i.badge&&e.jsx("span",{className:"text-sm text-red-500",children:i.badge.message})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(H,{label:"Notes",name:"notes",placeholder:"Enter additional details...",rows:4,...a("notes")})}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"Features"}),e.jsx(n,{type:"button",variant:"primary",onClick:()=>D({value:""}),size:"sm",children:e.jsx(v,{className:"w-4 h-4 text-white"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:T.map((s,t)=>e.jsxs("div",{className:"relative border rounded-lg shadow-sm bg-white dark:bg-gray-800 p-4",children:[e.jsx("div",{className:"absolute -top-2 -right-2 flex gap-1",children:t>0&&e.jsx(n,{type:"button",variant:"danger",className:"z-10",size:"sm",onClick:()=>S(t),children:e.jsx(P,{className:"w-3 h-3 text-white"})})}),e.jsx(c,{placeholder:`Feature ${t+1}`,...a(`features.${t}.value`),className:"w-full"})]},s.id))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"Prices"}),e.jsx(n,{type:"button",variant:"primary",onClick:()=>M({currency:"",amount:0}),size:"sm",children:e.jsx(v,{className:"w-4 h-4 text-white"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:E.map((s,t)=>e.jsxs("div",{className:"relative border rounded-lg shadow-sm bg-white dark:bg-gray-800 p-4",children:[e.jsx("div",{className:"absolute -top-2 -right-2 flex gap-1",children:t>0&&e.jsx(n,{type:"button",variant:"danger",className:"z-10",size:"sm",onClick:()=>F(t),children:e.jsx(P,{className:"w-3 h-3 text-white"})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(c,{placeholder:"Currency (e.g. USD)",className:"w-28",...a(`pricePairs.${t}.currency`,{pattern:{value:/^[A-Z]{1,5}$/,message:"Must be 1 to 5 uppercase letters"}})}),e.jsx(c,{placeholder:"Amount",...a(`pricePairs.${t}.amount`,{min:{value:0,message:"Must be â‰¥ 0"}})})]})]},s.id))})]})]})]}),e.jsxs("div",{className:"pt-6 flex justify-end",children:[e.jsx(n,{variant:"danger",className:"mr-2",type:"button",onClick:()=>p("/admin/packages"),children:"Cancel"}),e.jsx(n,{type:"submit",isLoading:C,children:"Update"})]})]})})})};export{_ as default};
